<!DOCTYPE html>
<html lang="en">

<head>
	<meta name="description" content="Mariage Lucie Benoit" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="utf-8">
	<title>Lucie & Benoît</title>
	<meta name="author" content="QP">
	<link rel="preload" href="css/font1.css" as="style" />
	<link rel="stylesheet" id="styleSheet" href="css/style.css">
	<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
	<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
	<link rel="stylesheet" href="css/font1.css">
</head>

<body onload="loaded();">
<canvas id="spawncontainer"></canvas>
<div class="container" >
	<div id="loaderScreen">
		<ion-icon name="heart-outline"></ion-icon>
		<div id="loadPoints"></div>
	</div>
	<div id="intro">
		<ion-icon name="heart-outline"></ion-icon>
		<div>
			Pour fêter votre mariage, j'ai cherché un truc original...<br>
			<br>
			Voici un son qui tente de représenter votre union, ainsi que quelques retouches d'une jolie photo de vous deux.<br>
			<br>
			Je vous souhaite le meilleur !<br>
			<br>
			<br>
		Quentin
		</div>
		<div>
			<span>Cliquez...</span>
		</div>
	</div>
	<div id="main">
		<div id="textZone">
			<span>Cliquez...</span>
		</div>
		<div id="photosZone">
			<div id="photoFrame">
				<img id="topPhoto" src="data\images\0.jpg"/>
				<img id="botPhoto" src="data\images\1.jpg"/>
			</div>
		</div>
		<div id="audioZone">
			<audio controls controlslist="nodownload noplaybackrate">
			   <source src="data/mashup_ff_dion.mp3">
			</audio>
		</div>
	</div>
	
</div>

<script>

const loaderScreen = document.getElementById("loaderScreen");
const intro = document.getElementById("intro");
const main = document.getElementById("main");
const topPhoto = document.getElementById("topPhoto");
const botPhoto = document.getElementById("botPhoto");
var images = new Array();
var indexTop = -1;
var indexBot = -1;


var heart = new Image();
heart.src = "data/heart.svg";
var bubbles = 8;
var spawnc = document.getElementById("spawncontainer");
var width = spawnc.width = window.innerWidth;
var height = spawnc.height = window.innerHeight;
var fontSize = parseInt(window.getComputedStyle(main).fontSize);
var spawnctx = spawnc.getContext("2d");
window.addEventListener('resize', function(event) {
	var width = spawnc.width = window.innerWidth;
var height = spawnc.height = window.innerHeight;
    fontSize = parseInt(window.getComputedStyle(main).fontSize);
}, true);

function render(particles, spawnctx, width, height) {
  requestAnimationFrame(() => render(particles, spawnctx, width, height));
  spawnctx.clearRect(0, 0, width, height);
  particles.forEach((p, i) => {
    p.x += p.speed * Math.cos(p.rotation * Math.PI / 180);
    p.y += p.speed * Math.sin(p.rotation * Math.PI / 180);
    p.opacity -= 0.01;
    p.speed *= p.friction;
    p.radius *= p.friction;
    p.yVel += p.gravity;
    p.y += p.yVel;
    if(p.opacity < 0 || p.radius < 0) {
		particles.splice(i, 1);
	}
	spawnctx.globalAlpha = p.opacity;
    spawnctx.drawImage(heart, 0, 0, 24, 24, p.x - p.radius / 2, p.y - p.radius / 2, p.radius, p.radius);
  });
  return spawnctx;
}

var r = (a, b, c) => parseFloat((Math.random() * ((a ? a : 1) - (b ? b : 0)) + (b ? b : 0)).toFixed(c ? c : 0));

function spawn(event){
  var mousex = event.clientX;
  var mousey = event.clientY;
  spawnctx.fillRect(mousex - (width / 2), mousey - (height / 2), width, height);
  var particles = [];
  var ratio = window.devicePixelRatio;
  
  for(var i = 0; i < bubbles; i++) {
    particles.push({
      x: mousex,
      y: mousey,
      radius: r(fontSize * 3, fontSize * 10),
      rotation: r(0, 360, true),
      speed: r(5, 10),
      friction: 0.91,
      opacity: r(0, 0.5, true),
      yVel: 0,
      gravity: 0.1
    });
  }
  
  render(particles, spawnctx, spawnc.width, spawnc.height);
}

document.onclick = spawn;

function loaded(){
	preloadPhotos();
}

function goMain(){
	intro.classList.add("fadeOut");
	main.addEventListener("click", click);
}

function click(){
	if(topPhoto.classList.contains("getBot")){
		indexTop = getRandomIndex();
		topPhoto.src = images[indexTop].src;
		topPhoto.classList.remove("getBot");
		botPhoto.classList.remove("getBot");
	}	
	else{
		indexBot = getRandomIndex();
		botPhoto.src = images[indexBot].src;
		topPhoto.classList.add("getBot");
		botPhoto.classList.add("getBot");
	}
	
}

function preloadPhotos(){
	for (var i = 0; i <= 90; i++) {
		images[i] = new Image();
		images[i].src = "data/images/" + i + ".jpg";
	}
	indexTop = getRandomIndex();
	topPhoto.src = images[indexTop].src;
	indexBot = getRandomIndex();
	botPhoto.src = images[indexBot].src;
	
	intro.addEventListener("click", goMain);
	loaderScreen.classList.add("fadeOut");
}

function getRandomIndex(){
	var index = 0;
	do{
		index = Math.floor(Math.random() * images.length);
	} while (index == indexTop || index == indexBot)
	return index
}


function preload() {
	for (var i = 0; i < preload.arguments.length; i++) {
		images[i] = new Image()
		images[i].src = preload.arguments[i]
	}
	
}

</script>
</body>
</html>
